// isDefined tests
test("cluster creating", function() {

  var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"NuwWzFT8QniVldc1UQG8mg","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","attributes":{}},"rp34Y0KOQcyMqSk5hLthMA":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobar"}],"1":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}],"nodes":{"rp34Y0KOQcyMqSk5hLthMA":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobar"},{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobaz"}],"NuwWzFT8QniVldc1UQG8mg":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"}]}},"allocations":[]}');
  var indexStats = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6909,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6988,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6794,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6794,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":115,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":194,"throttle_time_in_millis":0}}}}}');
  var nodeStats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMA":{"timestamp":1428258598640,"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9301]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3512,"throttle_time_in_millis":0},"indexing":{"index_total":12,"index_time_in_millis":91,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":894,"total_time_in_millis":155},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":96},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598642,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23855104,"used_in_bytes":8566079488,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977606144,"actual_used_in_bytes":6612328448},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598642,"open_file_descriptors":269,"cpu":{"percent":2,"sys_in_millis":1761575,"user_in_millis":1357870,"total_in_millis":3119445},"mem":{"resident_in_bytes":314048512,"share_in_bytes":-1,"total_virtual_in_bytes":5245059072}},"jvm":{"timestamp":1428258598642,"uptime_in_millis":31758055,"mem":{"heap_used_in_bytes":166384936,"heap_used_percent":16,"heap_committed_in_bytes":301072384,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":67806432,"non_heap_committed_in_bytes":69025792,"pools":{"young":{"used_in_bytes":20497760,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1389120,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":144498056,"max_in_bytes":715849728,"peak_used_in_bytes":167318504,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":155},"gc":{"collectors":{"young":{"collection_count":1444,"collection_time_in_millis":7424},"old":{"collection_count":7,"collection_time_in_millis":213}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":14861633,"total_capacity_in_bytes":14861633},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":8,"queue":0,"active":0,"rejected":0,"largest":8,"completed":12},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":887},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":84,"completed":48314},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1727},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9381257},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":3},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598643,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/1","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461239,"rx_size_in_bytes":681710275,"tx_count":4015361,"tx_size_in_bytes":883070844},"http":{"current_open":0,"total_opened":0},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}},"NuwWzFT8QniVldc1UQG8mg":{"timestamp":1428258598640,"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9300]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3476,"throttle_time_in_millis":0},"indexing":{"index_total":4,"index_time_in_millis":52,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2243,"total_time_in_millis":44},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":48},"translog":{"operations":4,"size_in_bytes":17},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598641,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23826432,"used_in_bytes":8566108160,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977577472,"actual_used_in_bytes":6612357120},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598641,"open_file_descriptors":275,"cpu":{"percent":4,"sys_in_millis":1822662,"user_in_millis":2723514,"total_in_millis":4546176},"mem":{"resident_in_bytes":435740672,"share_in_bytes":-1,"total_virtual_in_bytes":5262680064}},"jvm":{"timestamp":1428258598641,"uptime_in_millis":31763783,"mem":{"heap_used_in_bytes":136741120,"heap_used_percent":13,"heap_committed_in_bytes":300158976,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":76866312,"non_heap_committed_in_bytes":78594048,"pools":{"young":{"used_in_bytes":7647128,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1184128,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":127909864,"max_in_bytes":715849728,"peak_used_in_bytes":182802344,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":197},"gc":{"collectors":{"young":{"collection_count":12165,"collection_time_in_millis":45672},"old":{"collection_count":336,"collection_time_in_millis":7642}}},"buffer_pools":{"direct":{"count":606,"used_in_bytes":36225824,"total_capacity_in_bytes":36225824},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":23935},"index":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":4},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":883},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":119,"completed":18072},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1730},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9517979},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":1},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598642,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/0","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461238,"rx_size_in_bytes":883070832,"tx_count":913780,"tx_size_in_bytes":681710263},"http":{"current_open":6,"total_opened":75},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}}}}');
  var settings = JSON.parse('{"foobaz":{"settings":{"index":{"creation_date":"1428258597161","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","version":{"created":"1040199"},"uuid":"6dqDQHdnQn21srLwHCKiGQ"}}},"foobar":{"settings":{"index":{"creation_date":"1428258597086","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","version":{"created":"1040199"},"uuid":"SVAq9l98SXivmGS971WCNQ"}}}}');
  var aliases = JSON.parse('{"foobaz":{},"qux":{},"foobar":{}}');
  var health = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1}');
  var nodes = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMA":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9201]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91882,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226841437,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9200]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91875,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226835798,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');

  var cluster = new Cluster(health, state, indexStats, nodeStats, settings, aliases, nodes);

  var size_pattern = /\d+\.\d+\w{1,2}/;
  var number_pattern = /\d+/;

  // check clustercluster properties
  equal(cluster.num_docs, 8, "Number of documents");
  //equal(cluster.total_size == '16.49KB', "Checking total size");
  equal(cluster.unassigned_shards, 1, "Unassigned shards");
  equal(cluster.shards, 5, "Number of shards");
  equal(cluster.total_indices, 3, "Number of indices");
  var master_node = cluster.master_node;

  // index info
  ok(cluster.indices.length, 3, "Indices list length");

  var indices = cluster.indices;
  indices.forEach(function(index) {
    ok(index.state == 'open' || index.state == 'close',
        "Checking index state: [" + index.state + "]");
    if (index.state == 'open') {
      ok(number_pattern.test(index.size_in_bytes),
          "Checking primary size: [" + index.size_in_bytes + "]");
      ok(number_pattern.test(index.total_size_in_bytes),
          "Checking total size: [" + index.total_size_in_bytes + "]");
    }
    ok(number_pattern.test(index.num_docs),
        "Checking num docs: [" + index.num_docs + "]");
    ok(number_pattern.test(index.deleted_docs),
        "Checking deleted docs: [" + index.deleted_docs + "]");
    ok(index.name.length > 0, "Checking index name: [" + index.name + "]");
    ok(number_pattern.test(index.num_of_shards),
        "Checking number of shards: [" + index.num_of_shards + "]");
    ok(number_pattern.test(index.num_of_replicas),
        "Checking number of replicas: [" + index.num_of_replicas + "]");
    var node_ids = cluster.getNodes(true).map(function(node) {
      return node.id;
    });
    node_ids.forEach(function(node_id) {
      if (cluster.getShards(node_id, index.id) != null) {
        cluster.getShards(node_id, index.id).forEach(function(shard) {
          ok(shard.primary == true || shard.primary == false,
              "Checking primary status: [" + shard.primary + "]");
          equal(shard.node, node_id,
              "Shards should have referece to correct node");
          ok(shard.state == 'STARTED',
              "Shards should be started: [" + shard.state + "]");
        });
      }
    });

  });

  // check nodes
  var nodes = cluster.getNodes();
  equal(nodes.length, 2, "Unfiltered node list");
  var master_nodes = 0;
  nodes.forEach(function(node) {
    ok(number_pattern.test(node.disk_total_in_bytes),
        "Checking disk total [" + node.disk_total_in_bytes + "]");
    ok(number_pattern.test(node.disk_free_in_bytes),
        "Checking free disk [" + node.disk_free_in_bytes + "]");
    ok(node.disk_used_percent >= 0 && node.disk_used_percent <= 100,
        "Checking disk usage in percent [" + node.disk_used_percent + "]");
    ok(size_pattern.test(node.heap_used),
        "Checking node heap used [" + node.heap_used + "]");
    ok(size_pattern.test(node.heap_committed),
        "Checking node heap commited [" + node.heap_committed + "]");
    ok(size_pattern.test(node.heap_max),
        "Checking max heap size [" + node.heap_max + "]");
    ok(node.heap_used_percent >= 0 && node.heap_used_percent <= 100,
        "Checking heap used percent [" + node.heap_used_percent + "]");
    ok(node.cpu_user >= 0 && number_pattern.test(node.cpu_user),
        "Checking os user cpu [" + node.cpu_user + "]");
    ok(node.cpu_sys >= 0 && number_pattern.test(node.cpu_sys),
        "Checking os sys cpu [" + node.cpu_sys + "]");
    equal(node.id.length, 22, "Checking node id length");
    equal(node.jvmVersion, '1.8.0_40', "Checking node jvm version");
    equal(node.elasticVersion, '1.4.1', "Checking node es version");
    if (node.current_master) {
      master_nodes += 1;
      equal(master_node, node.id, "Checking current master");
    }
  });
  equal(master_nodes, 1, "There should be exactly one master node");
});

test("computing cluster changes", function() {
  var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"NuwWzFT8QniVldc1UQG8mg","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","attributes":{}},"rp34Y0KOQcyMqSk5hLthMA":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobar"}],"1":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}],"nodes":{"rp34Y0KOQcyMqSk5hLthMA":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobar"},{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobaz"}],"NuwWzFT8QniVldc1UQG8mg":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"}]}},"allocations":[]}');
  var indexStats = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6909,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6988,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6794,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6794,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":115,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":194,"throttle_time_in_millis":0}}}}}');
  var nodeStats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMA":{"timestamp":1428258598640,"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9301]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3512,"throttle_time_in_millis":0},"indexing":{"index_total":12,"index_time_in_millis":91,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":894,"total_time_in_millis":155},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":96},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598642,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23855104,"used_in_bytes":8566079488,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977606144,"actual_used_in_bytes":6612328448},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598642,"open_file_descriptors":269,"cpu":{"percent":2,"sys_in_millis":1761575,"user_in_millis":1357870,"total_in_millis":3119445},"mem":{"resident_in_bytes":314048512,"share_in_bytes":-1,"total_virtual_in_bytes":5245059072}},"jvm":{"timestamp":1428258598642,"uptime_in_millis":31758055,"mem":{"heap_used_in_bytes":166384936,"heap_used_percent":16,"heap_committed_in_bytes":301072384,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":67806432,"non_heap_committed_in_bytes":69025792,"pools":{"young":{"used_in_bytes":20497760,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1389120,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":144498056,"max_in_bytes":715849728,"peak_used_in_bytes":167318504,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":155},"gc":{"collectors":{"young":{"collection_count":1444,"collection_time_in_millis":7424},"old":{"collection_count":7,"collection_time_in_millis":213}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":14861633,"total_capacity_in_bytes":14861633},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":8,"queue":0,"active":0,"rejected":0,"largest":8,"completed":12},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":887},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":84,"completed":48314},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1727},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9381257},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":3},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598643,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/1","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461239,"rx_size_in_bytes":681710275,"tx_count":4015361,"tx_size_in_bytes":883070844},"http":{"current_open":0,"total_opened":0},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}},"NuwWzFT8QniVldc1UQG8mg":{"timestamp":1428258598640,"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9300]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3476,"throttle_time_in_millis":0},"indexing":{"index_total":4,"index_time_in_millis":52,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2243,"total_time_in_millis":44},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":48},"translog":{"operations":4,"size_in_bytes":17},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598641,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23826432,"used_in_bytes":8566108160,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977577472,"actual_used_in_bytes":6612357120},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598641,"open_file_descriptors":275,"cpu":{"percent":4,"sys_in_millis":1822662,"user_in_millis":2723514,"total_in_millis":4546176},"mem":{"resident_in_bytes":435740672,"share_in_bytes":-1,"total_virtual_in_bytes":5262680064}},"jvm":{"timestamp":1428258598641,"uptime_in_millis":31763783,"mem":{"heap_used_in_bytes":136741120,"heap_used_percent":13,"heap_committed_in_bytes":300158976,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":76866312,"non_heap_committed_in_bytes":78594048,"pools":{"young":{"used_in_bytes":7647128,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1184128,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":127909864,"max_in_bytes":715849728,"peak_used_in_bytes":182802344,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":197},"gc":{"collectors":{"young":{"collection_count":12165,"collection_time_in_millis":45672},"old":{"collection_count":336,"collection_time_in_millis":7642}}},"buffer_pools":{"direct":{"count":606,"used_in_bytes":36225824,"total_capacity_in_bytes":36225824},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":23935},"index":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":4},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":883},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":119,"completed":18072},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1730},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9517979},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":1},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598642,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/0","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461238,"rx_size_in_bytes":883070832,"tx_count":913780,"tx_size_in_bytes":681710263},"http":{"current_open":6,"total_opened":75},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}}}}');
  var settings = JSON.parse('{"foobaz":{"settings":{"index":{"creation_date":"1428258597161","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","version":{"created":"1040199"},"uuid":"6dqDQHdnQn21srLwHCKiGQ"}}},"foobar":{"settings":{"index":{"creation_date":"1428258597086","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","version":{"created":"1040199"},"uuid":"SVAq9l98SXivmGS971WCNQ"}}}}');
  var aliases = JSON.parse('{"foobaz":{},"qux":{},"foobar":{}}');
  var health = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1}');
  var nodes = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMA":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9201]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91882,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226841437,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9200]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91875,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226835798,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
  var cluster = new Cluster(health, state, indexStats, nodeStats, settings, aliases, nodes);

  var state2 = JSON.parse('{"cluster_name":"elasticsearch","master_node":"NuwWzFT8QniVldc1UQG8mg","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","attributes":{}},"rp34Y0KOQcyMqSk5hLthMB":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobar"}],"1":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}],"nodes":{"rp34Y0KOQcyMqSk5hLthMB":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobar"},{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobaz"}],"NuwWzFT8QniVldc1UQG8mg":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"}]}},"allocations":[]}');
  var indexStats2 = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7909,"throttle_time_in_millis":0}},"total":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7988,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7794,"throttle_time_in_millis":0}},"total":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7794,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":115,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":194,"throttle_time_in_millis":0}}}}}');
  var nodeStats2 = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMB":{"timestamp":1428258598640,"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9301]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3512,"throttle_time_in_millis":0},"indexing":{"index_total":12,"index_time_in_millis":91,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":894,"total_time_in_millis":155},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":96},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598642,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23855104,"used_in_bytes":8566079488,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977606144,"actual_used_in_bytes":6612328448},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598642,"open_file_descriptors":269,"cpu":{"percent":2,"sys_in_millis":1761575,"user_in_millis":1357870,"total_in_millis":3119445},"mem":{"resident_in_bytes":314048512,"share_in_bytes":-1,"total_virtual_in_bytes":5245059072}},"jvm":{"timestamp":1428258598642,"uptime_in_millis":31758055,"mem":{"heap_used_in_bytes":166384936,"heap_used_percent":16,"heap_committed_in_bytes":301072384,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":67806432,"non_heap_committed_in_bytes":69025792,"pools":{"young":{"used_in_bytes":20497760,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1389120,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":144498056,"max_in_bytes":715849728,"peak_used_in_bytes":167318504,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":155},"gc":{"collectors":{"young":{"collection_count":1444,"collection_time_in_millis":7424},"old":{"collection_count":7,"collection_time_in_millis":213}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":14861633,"total_capacity_in_bytes":14861633},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":8,"queue":0,"active":0,"rejected":0,"largest":8,"completed":12},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":887},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":84,"completed":48314},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1727},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9381257},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":3},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598643,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/1","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461239,"rx_size_in_bytes":681710275,"tx_count":4015361,"tx_size_in_bytes":883070844},"http":{"current_open":0,"total_opened":0},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}},"NuwWzFT8QniVldc1UQG8mg":{"timestamp":1428258598640,"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9300]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3476,"throttle_time_in_millis":0},"indexing":{"index_total":4,"index_time_in_millis":52,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2243,"total_time_in_millis":44},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":48},"translog":{"operations":4,"size_in_bytes":17},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598641,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23826432,"used_in_bytes":8566108160,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977577472,"actual_used_in_bytes":6612357120},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598641,"open_file_descriptors":275,"cpu":{"percent":4,"sys_in_millis":1822662,"user_in_millis":2723514,"total_in_millis":4546176},"mem":{"resident_in_bytes":435740672,"share_in_bytes":-1,"total_virtual_in_bytes":5262680064}},"jvm":{"timestamp":1428258598641,"uptime_in_millis":31763783,"mem":{"heap_used_in_bytes":136741120,"heap_used_percent":13,"heap_committed_in_bytes":300158976,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":76866312,"non_heap_committed_in_bytes":78594048,"pools":{"young":{"used_in_bytes":7647128,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1184128,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":127909864,"max_in_bytes":715849728,"peak_used_in_bytes":182802344,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":197},"gc":{"collectors":{"young":{"collection_count":12165,"collection_time_in_millis":45672},"old":{"collection_count":336,"collection_time_in_millis":7642}}},"buffer_pools":{"direct":{"count":606,"used_in_bytes":36225824,"total_capacity_in_bytes":36225824},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":23935},"index":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":4},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":883},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":119,"completed":18072},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1730},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9517979},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":1},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598642,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/0","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461238,"rx_size_in_bytes":883070832,"tx_count":913780,"tx_size_in_bytes":681710263},"http":{"current_open":6,"total_opened":75},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}}}}');
  var settings2 = JSON.parse('{"foobaz":{"settings":{"index":{"creation_date":"1428258597161","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","version":{"created":"1040199"},"uuid":"6dqDQHdnQn21srLwHCKiGQ"}}},"foobar":{"settings":{"index":{"creation_date":"1428258597086","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","version":{"created":"1040199"},"uuid":"SVAq9l98SXivmGS971WCNQ"}}}}');
  var aliases2 = JSON.parse('{"foobaz":{},"qux":{},"foobar":{}}');
  var health2 = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1}');
  var nodes2 = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMB":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9201]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91882,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226841437,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9200]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91875,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226835798,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
  var cluster2 = new Cluster(health2, state2, indexStats2, nodeStats2, settings2, aliases2, nodes2);

  cluster2.computeChanges(cluster);

  ok(cluster2.changes.getDocDelta() == -1, "Checking document delta ");
  ok(cluster2.changes.getDataDelta() == 1000,
      "" + cluster2.changes.getDataDelta());
  ok(cluster2.changes.absDataDelta() == "1000.00b",
      "" + cluster2.changes.absDataDelta());

  ok(cluster2.changes.nodeJoins.length == 1, "checking joinng nodes");
  ok(cluster2.changes.nodeLeaves.length == 1, "checking disconnecting nodes");

  ok(cluster2.changes.nodeJoins[0].id == "rp34Y0KOQcyMqSk5hLthMB",
      "checking node identity");
  ok(cluster2.changes.nodeLeaves[0].id == "rp34Y0KOQcyMqSk5hLthMA",
      "checking node identity");
});

test("computing cluster changes on two different clusters should yield no changes",
    function() {
      var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"NuwWzFT8QniVldc1UQG8mg","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","attributes":{}},"rp34Y0KOQcyMqSk5hLthMA":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobar"}],"1":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}],"nodes":{"rp34Y0KOQcyMqSk5hLthMA":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobar"},{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMA","relocating_node":null,"shard":0,"index":"foobaz"}],"NuwWzFT8QniVldc1UQG8mg":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"}]}},"allocations":[]}');
      var indexStats = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6909,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6988,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6794,"throttle_time_in_millis":0}},"total":{"docs":{"count":8,"deleted":0},"store":{"size_in_bytes":6794,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":115,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":194,"throttle_time_in_millis":0}}}}}');
      var nodeStats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMA":{"timestamp":1428258598640,"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9301]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3512,"throttle_time_in_millis":0},"indexing":{"index_total":12,"index_time_in_millis":91,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":894,"total_time_in_millis":155},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":96},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598642,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23855104,"used_in_bytes":8566079488,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977606144,"actual_used_in_bytes":6612328448},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598642,"open_file_descriptors":269,"cpu":{"percent":2,"sys_in_millis":1761575,"user_in_millis":1357870,"total_in_millis":3119445},"mem":{"resident_in_bytes":314048512,"share_in_bytes":-1,"total_virtual_in_bytes":5245059072}},"jvm":{"timestamp":1428258598642,"uptime_in_millis":31758055,"mem":{"heap_used_in_bytes":166384936,"heap_used_percent":16,"heap_committed_in_bytes":301072384,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":67806432,"non_heap_committed_in_bytes":69025792,"pools":{"young":{"used_in_bytes":20497760,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1389120,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":144498056,"max_in_bytes":715849728,"peak_used_in_bytes":167318504,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":155},"gc":{"collectors":{"young":{"collection_count":1444,"collection_time_in_millis":7424},"old":{"collection_count":7,"collection_time_in_millis":213}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":14861633,"total_capacity_in_bytes":14861633},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":8,"queue":0,"active":0,"rejected":0,"largest":8,"completed":12},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":887},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":84,"completed":48314},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1727},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9381257},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":3},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598643,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/1","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461239,"rx_size_in_bytes":681710275,"tx_count":4015361,"tx_size_in_bytes":883070844},"http":{"current_open":0,"total_opened":0},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}},"NuwWzFT8QniVldc1UQG8mg":{"timestamp":1428258598640,"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9300]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3476,"throttle_time_in_millis":0},"indexing":{"index_total":4,"index_time_in_millis":52,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2243,"total_time_in_millis":44},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":48},"translog":{"operations":4,"size_in_bytes":17},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598641,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23826432,"used_in_bytes":8566108160,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977577472,"actual_used_in_bytes":6612357120},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598641,"open_file_descriptors":275,"cpu":{"percent":4,"sys_in_millis":1822662,"user_in_millis":2723514,"total_in_millis":4546176},"mem":{"resident_in_bytes":435740672,"share_in_bytes":-1,"total_virtual_in_bytes":5262680064}},"jvm":{"timestamp":1428258598641,"uptime_in_millis":31763783,"mem":{"heap_used_in_bytes":136741120,"heap_used_percent":13,"heap_committed_in_bytes":300158976,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":76866312,"non_heap_committed_in_bytes":78594048,"pools":{"young":{"used_in_bytes":7647128,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1184128,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":127909864,"max_in_bytes":715849728,"peak_used_in_bytes":182802344,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":197},"gc":{"collectors":{"young":{"collection_count":12165,"collection_time_in_millis":45672},"old":{"collection_count":336,"collection_time_in_millis":7642}}},"buffer_pools":{"direct":{"count":606,"used_in_bytes":36225824,"total_capacity_in_bytes":36225824},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":23935},"index":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":4},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":883},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":119,"completed":18072},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1730},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9517979},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":1},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598642,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/0","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461238,"rx_size_in_bytes":883070832,"tx_count":913780,"tx_size_in_bytes":681710263},"http":{"current_open":6,"total_opened":75},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}}}}');
      var settings = JSON.parse('{"foobaz":{"settings":{"index":{"creation_date":"1428258597161","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","version":{"created":"1040199"},"uuid":"6dqDQHdnQn21srLwHCKiGQ"}}},"foobar":{"settings":{"index":{"creation_date":"1428258597086","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","version":{"created":"1040199"},"uuid":"SVAq9l98SXivmGS971WCNQ"}}}}');
      var aliases = JSON.parse('{"foobaz":{},"qux":{},"foobar":{}}');
      var health = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1}');
      var nodes = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMA":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9201]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91882,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226841437,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9200]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91875,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226835798,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
      var cluster = new Cluster(health, state, indexStats, nodeStats, settings, aliases, nodes);

      var state2 = JSON.parse('{"cluster_name":"elasticsearch2","master_node":"NuwWzFT8QniVldc1UQG8mg","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","attributes":{}},"rp34Y0KOQcyMqSk5hLthMB":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobar"}],"1":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}],"nodes":{"rp34Y0KOQcyMqSk5hLthMB":[{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobar"},{"state":"STARTED","primary":true,"node":"rp34Y0KOQcyMqSk5hLthMB","relocating_node":null,"shard":0,"index":"foobaz"}],"NuwWzFT8QniVldc1UQG8mg":[{"state":"STARTED","primary":true,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":1,"index":"foobar"},{"state":"STARTED","primary":false,"node":"NuwWzFT8QniVldc1UQG8mg","relocating_node":null,"shard":0,"index":"foobaz"}]}},"allocations":[]}');
      var indexStats2 = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"_all":{"primaries":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7909,"throttle_time_in_millis":0}},"total":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7988,"throttle_time_in_millis":0}}},"indices":{"foobar":{"primaries":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7794,"throttle_time_in_millis":0}},"total":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":7794,"throttle_time_in_millis":0}}},"foobaz":{"primaries":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":115,"throttle_time_in_millis":0}},"total":{"docs":{"count":0,"deleted":0},"store":{"size_in_bytes":194,"throttle_time_in_millis":0}}}}}');
      var nodeStats2 = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMB":{"timestamp":1428258598640,"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9301]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3512,"throttle_time_in_millis":0},"indexing":{"index_total":12,"index_time_in_millis":91,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":894,"total_time_in_millis":155},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":96},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598642,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23855104,"used_in_bytes":8566079488,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977606144,"actual_used_in_bytes":6612328448},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598642,"open_file_descriptors":269,"cpu":{"percent":2,"sys_in_millis":1761575,"user_in_millis":1357870,"total_in_millis":3119445},"mem":{"resident_in_bytes":314048512,"share_in_bytes":-1,"total_virtual_in_bytes":5245059072}},"jvm":{"timestamp":1428258598642,"uptime_in_millis":31758055,"mem":{"heap_used_in_bytes":166384936,"heap_used_percent":16,"heap_committed_in_bytes":301072384,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":67806432,"non_heap_committed_in_bytes":69025792,"pools":{"young":{"used_in_bytes":20497760,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1389120,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":144498056,"max_in_bytes":715849728,"peak_used_in_bytes":167318504,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":155},"gc":{"collectors":{"young":{"collection_count":1444,"collection_time_in_millis":7424},"old":{"collection_count":7,"collection_time_in_millis":213}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":14861633,"total_capacity_in_bytes":14861633},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"index":{"threads":8,"queue":0,"active":0,"rejected":0,"largest":8,"completed":12},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":887},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":84,"completed":48314},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1727},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9381257},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":3},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598643,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/1","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461239,"rx_size_in_bytes":681710275,"tx_count":4015361,"tx_size_in_bytes":883070844},"http":{"current_open":0,"total_opened":0},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}},"NuwWzFT8QniVldc1UQG8mg":{"timestamp":1428258598640,"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":["inet[/192.168.2.39:9300]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3476,"throttle_time_in_millis":0},"indexing":{"index_total":4,"index_time_in_millis":52,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0,"noop_update_total":0,"is_throttled":false,"throttle_time_in_millis":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2243,"total_time_in_millis":44},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":1},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8738,"index_writer_memory_in_bytes":0,"index_writer_max_memory_in_bytes":134217728,"version_map_memory_in_bytes":0,"fixed_bit_set_memory_in_bytes":48},"translog":{"operations":4,"size_in_bytes":17},"suggest":{"total":0,"time_in_millis":0,"current":0},"query_cache":{"memory_size_in_bytes":0,"evictions":0,"hit_count":0,"miss_count":0}},"os":{"timestamp":1428258598641,"uptime_in_millis":815148,"load_average":[2.771484375,3.1103515625,2.921875],"cpu":{"sys":3,"user":4,"idle":91,"usage":7,"stolen":0},"mem":{"free_in_bytes":23826432,"used_in_bytes":8566108160,"free_percent":23,"used_percent":76,"actual_free_in_bytes":1977577472,"actual_used_in_bytes":6612357120},"swap":{"used_in_bytes":1664090112,"free_in_bytes":1557135360}},"process":{"timestamp":1428258598641,"open_file_descriptors":275,"cpu":{"percent":4,"sys_in_millis":1822662,"user_in_millis":2723514,"total_in_millis":4546176},"mem":{"resident_in_bytes":435740672,"share_in_bytes":-1,"total_virtual_in_bytes":5262680064}},"jvm":{"timestamp":1428258598641,"uptime_in_millis":31763783,"mem":{"heap_used_in_bytes":136741120,"heap_used_percent":13,"heap_committed_in_bytes":300158976,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":76866312,"non_heap_committed_in_bytes":78594048,"pools":{"young":{"used_in_bytes":7647128,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":1184128,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":127909864,"max_in_bytes":715849728,"peak_used_in_bytes":182802344,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":197},"gc":{"collectors":{"young":{"collection_count":12165,"collection_time_in_millis":45672},"old":{"collection_count":336,"collection_time_in_millis":7642}}},"buffer_pools":{"direct":{"count":606,"used_in_bytes":36225824,"total_capacity_in_bytes":36225824},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"listener":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":23935},"index":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":4},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":883},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"generic":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":119,"completed":18072},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":4,"completed":1730},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":9517979},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":1},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":155063,"passive_opens":15454,"curr_estab":189,"in_segs":89932389,"out_segs":88817261,"retrans_segs":30884,"estab_resets":13643,"attempt_fails":11232,"in_errs":0,"out_rsts":-1}},"fs":{"timestamp":1428258598642,"total":{"total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.4.1/data/elasticsearch/nodes/0","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":63033049088,"available_in_bytes":62770905088,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":9461238,"rx_size_in_bytes":883070832,"tx_count":913780,"tx_size_in_bytes":681710263},"http":{"current_open":6,"total_opened":75},"breakers":{"fielddata":{"limit_size_in_bytes":622775500,"limit_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0},"request":{"limit_size_in_bytes":415183667,"limit_size":"395.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0},"parent":{"limit_size_in_bytes":726571417,"limit_size":"692.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.0,"tripped":0}}}}}');
      var settings2 = JSON.parse('{"foobaz":{"settings":{"index":{"creation_date":"1428258597161","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"1","number_of_replicas":"2","version":{"created":"1040199"},"uuid":"6dqDQHdnQn21srLwHCKiGQ"}}},"foobar":{"settings":{"index":{"creation_date":"1428258597086","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_shards":"2","number_of_replicas":"0","version":{"created":"1040199"},"uuid":"SVAq9l98SXivmGS971WCNQ"}}}}');
      var aliases2 = JSON.parse('{"foobaz":{},"qux":{},"foobar":{}}');
      var health2 = JSON.parse('{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":2,"number_of_data_nodes":2,"active_primary_shards":3,"active_shards":4,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":1}');
      var nodes2 = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"rp34Y0KOQcyMqSk5hLthMB":{"name":"Bill Foster","transport_address":"inet[/192.168.2.39:9301]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9201]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91882,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226841437,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}},"NuwWzFT8QniVldc1UQG8mg":{"name":"Shalla-Bal","transport_address":"inet[/192.168.2.39:9300]","host":"nb-lmenezes","ip":"192.168.2.39","version":"1.4.1","build":"89d3241","http_address":"inet[/192.168.2.39:9200]","os":{"refresh_interval_in_millis":1000,"available_processors":8,"cpu":{"vendor":"Intel","model":"MacBookPro10,1","mhz":2300,"total_cores":8,"total_sockets":8,"cores_per_socket":16,"cache_size_in_bytes":256},"mem":{"total_in_bytes":8589934592},"swap":{"total_in_bytes":3221225472}},"jvm":{"pid":91875,"version":"1.8.0_40","vm_name":"Java HotSpot(TM) 64-Bit Server VM","vm_version":"25.40-b25","vm_vendor":"Oracle Corporation","start_time_in_millis":1428226835798,"mem":{"heap_init_in_bytes":268435456,"heap_max_in_bytes":1037959168,"non_heap_init_in_bytes":2555904,"non_heap_max_in_bytes":0,"direct_max_in_bytes":1037959168},"gc_collectors":["ParNew","ConcurrentMarkSweep"],"memory_pools":["Code Cache","Metaspace","Compressed Class Space","Par Eden Space","Par Survivor Space","CMS Old Gen"]}}}}');
      var cluster2 = new Cluster(health2, state2, indexStats2, nodeStats2, settings2, aliases2, nodes2);

      cluster2.computeChanges(cluster);
      ok(cluster2.changes.hasChanges() == false, "No changes");
    });
